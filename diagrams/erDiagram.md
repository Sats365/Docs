---
title: ER-диаграммы
order: 3
---
Данные диаграммы необходимы для описание структуры БД.
Для вставки ER-диаграммы служит конструкция `[db-diagram:<путь>]`, где:

- `путь` -- путь к YAML-файлу с описанием схемы относительно файла статьи.

## Структура YAML-файла диаграммы

Диаграмма строится над схемой БД описанной с помощью функционала [Описание схемы БД](../markdown/dev/tables.md).

Описание и примеры значений:

```yaml
schema: ./model.yaml # путь к файлу с описанием таблиц (относительно текущего файла)
tables: # таблицы, которые используются в схеме
    Contract: # таблица
        position: 100, 100 # координаты левого верхнего угла таблицы
        links: # описание линий связывающих таблицы. Необязательно
            ID_Contractor: # поля, имеющее refObject
                path: "40,90,-100,-50," # маршрут построения линии связи
    User:
        position: 700,100
    Contractor:
        position: 300,500
```

### Принципы описания линий

По умолчанию таблицы на диаграмме соединяются автоматически на основании значений свойства `refObject` в схеме БД.

Однако в некоторых случаях, при большом количестве таблиц, построение линий требуется уточнить. Для этого в свойстве таблицы `links` для поля таблицы задайте свойство `path` в формате: `<dX1>,<dY2>,<dX3>,<dY4>,...`

**Пример описания:** `path: "40,90,-100,-50,"`. Означает: 1) чертить линию на 40 направо 2) 90 вниз 3) 100 налево 4) 50 вверх 5) завершить линию самостоятельно.

Отдельные смещения можно не указывать, в этом случае линия по этому направлению дорисуется автоматически. Например: `path: "40,,50"`, задает длины горизонтальных линий `dX`, а вертикальная линия нарисуется автоматически.

## Пример

Для отображения диаграммы описанной в файле `./diagram.yaml` напишите:

```md
[db-diagram:./resources/er-diagram.yaml]
```

### Результат

---

[db-diagram:./resources/er-diagram.yaml]

## Тэги [alfa]

Для более гибкого управления отображением диаграммы можно пользоваться тэгами. Тэги могут быть как у таблиц, так и у полей. Для фильтрации по тегам используется следующая конструкция `[db-diagram:<путь>:<тэги>]`, где

- `тэги` -- список тегов через запятую с специальным знаком вначале.

Можно использовать сделующие знаки перед тэгом:

- `+` -- поля и таблицы будут отображаться только если у них есть *хотя бы один* тэг со знаком `+`

- `-` -- поля и таблицы будут отображаться только если у них нет *ни одного* тэга со знаком `-`

- `#` -- таблицы с этим тегом будут отображаться без полей (только заголовок). Если на эту таблицу не ссылается ни одно другое отображаемое поле, то таблица не выводится (это поведение можно изменить, если у таблицы будет хотя бы один тэг со знаком `+`, то она выводится в любом случае). Поля с этим тегом отображаются как обычно

### Пример использования тэгов

Описание тэгов таблицы:

```yaml
Contract:
    fields:
        ID:
            tags: hidden
        Number:
            tags: onlytitle
        ID_Author:
            tags: onlytitle,hidden
        ID_Contractor:
User:
    fields:
        ID:
        Login:
        Email:
    tags: hidden
Contractor:
    fields:
        ID:
        SomeField:
    tags: onlytitle
```

Результат использования `[db-diagram:./resources/diagram.yaml:-hidden,#onlytitle]`:

---

[db-diagram:./resources/er-diagram.yaml:-hidden,#onlytitle]